<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幸運籤筒 Vibe (單機版)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Babel Standalone (用於編譯 JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      /* 自定義動畫 Keyframes */
      @keyframes shake-hard {
        0% { transform: rotate(0deg) translate(0, 0); }
        10% { transform: rotate(-5deg) translate(-5px, -2px); }
        20% { transform: rotate(5deg) translate(5px, 2px); }
        30% { transform: rotate(-8deg) translate(-8px, 4px); }
        40% { transform: rotate(8deg) translate(8px, -4px); }
        50% { transform: rotate(-5deg) translate(-5px, 2px); }
        60% { transform: rotate(5deg) translate(5px, -2px); }
        70% { transform: rotate(-3deg) translate(-3px, 1px); }
        80% { transform: rotate(3deg) translate(3px, -1px); }
        90% { transform: rotate(-1deg) translate(-1px, 0); }
        100% { transform: rotate(0deg) translate(0, 0); }
      }
      @keyframes pop-up {
        0% { transform: translateY(100px) scale(0.5); opacity: 0; }
        60% { transform: translateY(-20px) scale(1.1); opacity: 1; }
        100% { transform: translateY(0) scale(1); opacity: 1; }
      }
      /* 直排文字支援 */
      .writing-vertical-rl {
        writing-mode: vertical-rl;
        text-orientation: upright;
      }
      /* 隱藏捲軸但保留功能 */
      .scrollbar-hide::-webkit-scrollbar {
          display: none;
      }
      .scrollbar-hide {
          -ms-overflow-style: none;
          scrollbar-width: none;
      }
    </style>
</head>
<body class="bg-[#8B2323]">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
          Trophy, Users, History, Plus, Trash2, Play, RefreshCcw, X, 
          CheckCircle2, Circle, Shuffle, CheckSquare, Square, Edit2, 
          Check, AlertCircle, Scroll
        } from 'https://esm.sh/lucide-react@0.263.1';

        function App() {
            // --- 狀態管理 (保留核心邏輯) ---
            
            const [participants, setParticipants] = useState(() => {
                try {
                const saved = localStorage.getItem('fortune_participants');
                return saved ? JSON.parse(saved) : ['小明', '阿華', '春嬌', '志明', '大壯'];
                } catch (e) { return []; }
            });

            const [selectedNames, setSelectedNames] = useState([]);
            
            const [history, setHistory] = useState(() => {
                try {
                const saved = localStorage.getItem('fortune_history');
                return saved ? JSON.parse(saved) : [];
                } catch (e) { return []; }
            });

            const [inputValue, setInputValue] = useState('');
            const [drawCount, setDrawCount] = useState(1);
            const [isShaking, setIsShaking] = useState(false); // 改名為 isShaking 更符合情境
            const [showResult, setShowResult] = useState(false);
            const [currentView, setCurrentView] = useState('draw'); 
            const [winners, setWinners] = useState([]);

            // 編輯與刪除狀態
            const [editingIndex, setEditingIndex] = useState(null);
            const [editValue, setEditValue] = useState('');
            const [deleteModal, setDeleteModal] = useState({ show: false, type: '', index: null, name: '' }); 
            const [toast, setToast] = useState({ show: false, message: '', type: '' });

            const editInputRef = useRef(null);

            // --- Helpers ---
            const showToast = (message, type = 'error') => {
                setToast({ show: true, message, type });
                setTimeout(() => setToast({ show: false, message: '', type: '' }), 3000);
            };

            // --- Effects ---
            useEffect(() => {
                setSelectedNames(prev => {
                const validNames = prev.filter(name => participants.includes(name));
                if (prev.length === 0 && participants.length > 0 && history.length === 0) {
                    return [...participants];
                }
                return validNames;
                });
            }, [participants.length]);

            useEffect(() => { localStorage.setItem('fortune_participants', JSON.stringify(participants)); }, [participants]);
            useEffect(() => { localStorage.setItem('fortune_history', JSON.stringify(history)); }, [history]);
            
            useEffect(() => {
                if (editingIndex !== null && editInputRef.current) editInputRef.current.focus();
            }, [editingIndex]);

            // --- 核心邏輯 ---

            const addParticipant = () => {
                const name = inputValue.trim();
                if (!name) return showToast('請輸入名字', 'error');
                if (participants.includes(name)) return showToast('名字已存在', 'error');
                setParticipants([...participants, name]);
                setSelectedNames(prev => [...prev, name]);
                setInputValue('');
                showToast(`已放入籤筒：${name}`, 'success');
            };

            const executeDelete = () => {
                if (deleteModal.type === 'single') {
                const newParticipants = participants.filter((_, i) => i !== deleteModal.index);
                setParticipants(newParticipants);
                showToast('移除成功', 'success');
                } else if (deleteModal.type === 'all-participants') {
                setParticipants([]);
                setSelectedNames([]);
                showToast('籤筒已清空', 'success');
                } else if (deleteModal.type === 'all-history') {
                setHistory([]);
                showToast('紀錄已清空', 'success');
                }
                setDeleteModal({ show: false, type: '', index: null, name: '' });
            };

            const saveEdit = (index) => {
                const newName = editValue.trim();
                const oldName = participants[index];
                if (!newName) return showToast('名字不能為空', 'error');
                if (newName !== oldName && participants.includes(newName)) return showToast('名字重複', 'error');

                const newParticipants = [...participants];
                newParticipants[index] = newName;
                setParticipants(newParticipants);

                if (selectedNames.includes(oldName)) {
                setSelectedNames(prev => [...prev.filter(n => n !== oldName), newName]);
                }
                setEditingIndex(null);
                showToast('修改成功', 'success');
            };

            // --- 抽籤邏輯 (改為籤筒模式) ---
            const handleDraw = () => {
                if (selectedNames.length === 0) return showToast('籤筒是空的！請先選人', 'error');
                
                setIsShaking(true);
                setShowResult(false);
                setWinners([]);
                
                // 搖晃時間
                setTimeout(() => {
                performFinalDraw(Math.min(drawCount, selectedNames.length));
                }, 1500); // 搖 1.5 秒
            };

            const performFinalDraw = (count) => {
                const shuffled = [...selectedNames].sort(() => 0.5 - Math.random());
                const result = shuffled.slice(0, count);
                
                setWinners(result);
                setIsShaking(false);
                setShowResult(true); // 顯示結果 Modal
                setDrawCount(Math.min(count, selectedNames.length));

                const newRecord = {
                id: Date.now(),
                date: new Date().toLocaleString(),
                result: result,
                count: result.length,
                poolSize: selectedNames.length
                };
                setHistory([newRecord, ...history]);
            };

            // 全選/切換
            const toggleAll = () => selectedNames.length === participants.length ? setSelectedNames([]) : setSelectedNames([...participants]);
            const toggleSelection = (name) => selectedNames.includes(name) ? setSelectedNames(prev => prev.filter(n => n !== name)) : setSelectedNames(prev => [...prev, name]);

            // --- UI Components ---

            return (
                <div className="min-h-screen bg-[#8B2323] p-4 font-sans text-gray-800 flex items-center justify-center relative overflow-hidden">
                
                {/* 背景紋理裝飾 */}
                <div className="absolute inset-0 opacity-10 pointer-events-none" 
                    style={{ backgroundImage: 'radial-gradient(circle, #FFD700 1px, transparent 1px)', backgroundSize: '30px 30px' }}></div>
                <div className="absolute -top-20 -left-20 w-64 h-64 bg-yellow-500 rounded-full blur-3xl opacity-20"></div>
                <div className="absolute bottom-0 right-0 w-80 h-80 bg-red-600 rounded-full blur-3xl opacity-30"></div>

                {/* Toast */}
                <div className={`fixed top-6 left-1/2 transform -translate-x-1/2 z-[60] transition-all duration-300 ${toast.show ? 'translate-y-0 opacity-100' : '-translate-y-10 opacity-0 pointer-events-none'}`}>
                    <div className={`px-6 py-3 rounded-full shadow-2xl flex items-center gap-2 font-bold text-sm border-2 ${toast.type === 'error' ? 'bg-[#3f1010] border-red-500 text-red-200' : 'bg-[#1a3b1a] border-green-500 text-green-200'}`}>
                    {toast.type === 'error' ? <AlertCircle className="w-4 h-4" /> : <CheckCircle2 className="w-4 h-4" />}
                    {toast.message}
                    </div>
                </div>

                {/* 結果展示 Modal (中獎畫面) */}
                {showResult && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onClick={() => setShowResult(false)}></div>
                    <div className="relative z-10 w-full max-w-sm flex flex-col items-center">
                        
                        {/* 光芒背景 */}
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-yellow-500/20 rounded-full blur-3xl animate-pulse"></div>
                        
                        <h2 className="text-3xl font-black text-[#FFD700] mb-8 drop-shadow-md tracking-widest animate-[pop-up_0.5s_ease-out]">
                        {winners.length > 1 ? '眾神眷顧' : '天選之人'}
                        </h2>

                        <div className="flex flex-wrap justify-center gap-4 perspective-1000">
                        {winners.map((winner, idx) => (
                            <div 
                            key={idx} 
                            className="animate-[pop-up_0.6s_cubic-bezier(0.175,0.885,0.32,1.275)_forwards]"
                            style={{ animationDelay: `${idx * 0.15}s` }}
                            >
                            {/* 竹籤樣式 */}
                            <div className="relative w-16 h-64 bg-[#E8D5B5] rounded-t-lg rounded-b-3xl shadow-[5px_5px_15px_rgba(0,0,0,0.5)] border-2 border-[#D4C4A8] flex flex-col items-center justify-start pt-6 overflow-hidden transform hover:scale-105 transition-transform duration-300">
                                {/* 紅頭 */}
                                <div className="absolute top-0 w-full h-4 bg-red-600/80"></div>
                                {/* 文字直排 */}
                                <span className="writing-vertical-rl text-2xl font-black text-gray-800 tracking-widest h-48 flex items-center justify-center font-serif">
                                {winner}
                                </span>
                                {/* 底部裝飾 */}
                                <div className="absolute bottom-4 text-[10px] text-gray-400 opacity-50 font-serif">大吉</div>
                            </div>
                            </div>
                        ))}
                        </div>

                        <button 
                        onClick={() => setShowResult(false)}
                        className="mt-12 px-10 py-3 bg-[#FFD700] text-red-900 font-bold rounded-full shadow-[0_0_20px_rgba(255,215,0,0.4)] hover:scale-105 hover:bg-[#ffe44d] transition-all border-2 border-[#B8860B]"
                        >
                        收下好運
                        </button>
                    </div>
                    </div>
                )}

                {/* Delete Modal */}
                {deleteModal.show && (
                    <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={() => setDeleteModal({ ...deleteModal, show: false })}></div>
                    <div className="bg-[#FFF8DC] border-2 border-[#DEB887] rounded-2xl p-6 w-full max-w-sm shadow-2xl relative z-10">
                        <h3 className="text-xl font-bold text-[#8B4513] mb-2 font-serif">確認操作</h3>
                        <p className="text-[#A0522D] mb-6">
                        {deleteModal.type === 'single' && `要把「${deleteModal.name}」移出籤筒嗎？`}
                        {deleteModal.type === 'all-participants' && `確定要倒空籤筒嗎？(清空所有名單)`}
                        {deleteModal.type === 'all-history' && `確定要燒毀紀錄嗎？(清空歷史)`}
                        </p>
                        <div className="flex gap-3">
                        <button onClick={() => setDeleteModal({ ...deleteModal, show: false })} className="flex-1 py-2 rounded-xl border border-[#DEB887] text-[#8B4513] font-bold hover:bg-[#FAEBD7]">取消</button>
                        <button onClick={executeDelete} className="flex-1 py-2 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700 shadow-md">確認</button>
                        </div>
                    </div>
                    </div>
                )}

                {/* Main Container */}
                <div className="w-full max-w-md bg-[#FFF8DC] shadow-[0_20px_50px_rgba(0,0,0,0.5)] rounded-3xl overflow-hidden flex flex-col h-[90vh] md:h-auto md:min-h-[750px] border-4 border-[#B8860B]">
                    
                    {/* Header - 匾額風格 */}
                    <div className="bg-[#8B0000] p-4 text-[#FFD700] text-center shadow-lg shrink-0 relative overflow-hidden border-b-4 border-[#B8860B]">
                    <div className="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/black-scales.png')]"></div>
                    <h1 className="text-3xl font-black flex items-center justify-center gap-3 tracking-[0.2em] font-serif drop-shadow-md">
                        <Scroll className="w-6 h-6" />
                        幸運籤筒
                        <Scroll className="w-6 h-6" />
                    </h1>
                    <p className="text-[#FFA07A] text-xs mt-1 font-serif tracking-widest">心誠則靈 · 有求必應</p>
                    </div>

                    {/* Navigation - 古風按鈕 */}
                    <div className="flex p-2 bg-[#FAEBD7] shrink-0 border-b border-[#DEB887]">
                    {[
                        { id: 'draw', icon: Trophy, label: '求籤' },
                        { id: 'manage', icon: Users, label: '名冊' },
                        { id: 'history', icon: History, label: '籤詩錄' },
                    ].map(tab => (
                        <button
                        key={tab.id}
                        onClick={() => setCurrentView(tab.id)}
                        className={`flex-1 flex flex-col items-center justify-center py-2 rounded-xl transition-all duration-200 text-sm font-bold font-serif ${
                            currentView === tab.id
                            ? 'bg-[#8B0000] text-[#FFD700] shadow-md scale-105 border border-[#B8860B]'
                            : 'text-[#8B4513] hover:bg-[#DEB887]/30'
                        }`}
                        >
                        <tab.icon className={`w-5 h-5 mb-1`} />
                        {tab.label}
                        </button>
                    ))}
                    </div>

                    {/* Content Area */}
                    <div className="flex-1 overflow-y-auto scrollbar-hide relative bg-[#FFF8DC]">
                    
                    {/* === View: Draw (籤筒畫面) === */}
                    {currentView === 'draw' && (
                        <div className="flex flex-col h-full">
                        
                        {/* 籤筒展示區 */}
                        <div className="flex-1 flex flex-col items-center justify-center p-6 min-h-[300px] relative">
                            
                            {/* 籤筒本體 */}
                            <div 
                            className="relative w-48 h-64 transition-transform duration-100"
                            style={{ 
                                animation: isShaking ? 'shake-hard 0.5s ease-in-out infinite' : 'none',
                                transformOrigin: 'bottom center'
                            }}
                            >
                            {/* 竹籤群 (裝飾用，插在筒裡) */}
                            <div className="absolute -top-10 left-1/2 -translate-x-1/2 w-32 h-20 flex justify-center items-end gap-1 overflow-hidden z-0">
                                {Array.from({ length: Math.min(10, selectedNames.length) }).map((_, i) => (
                                <div key={i} className="w-2 bg-[#E8D5B5] border border-[#D4C4A8] rounded-t-sm" 
                                        style={{ 
                                        height: `${40 + Math.random() * 40}%`, 
                                        transform: `rotate(${(i - 5) * 5}deg) translateY(${isShaking ? Math.random()*10 : 0}px)`,
                                        transition: 'transform 0.1s'
                                        }}></div>
                                ))}
                            </div>

                            {/* 筒身 - 3D 圓柱體效果 */}
                            <div className="absolute inset-0 z-10 bg-gradient-to-r from-[#8B0000] via-[#A52A2A] to-[#8B0000] rounded-b-3xl rounded-t-lg shadow-2xl border-x-2 border-b-4 border-[#5c0000] flex flex-col items-center justify-center">
                                {/* 金色裝飾環 */}
                                <div className="w-full h-4 bg-gradient-to-r from-[#B8860B] via-[#FFD700] to-[#B8860B] absolute top-4 shadow-sm"></div>
                                <div className="w-full h-4 bg-gradient-to-r from-[#B8860B] via-[#FFD700] to-[#B8860B] absolute bottom-8 shadow-sm"></div>
                                
                                {/* 筒身文字 */}
                                <div className="w-24 h-24 bg-[#FFD700] rotate-45 flex items-center justify-center border-4 border-[#B8860B] shadow-inner mt-2">
                                <div className="-rotate-45 font-serif font-black text-[#8B0000] text-4xl">吉</div>
                                </div>
                            </div>
                            </div>

                            {/* 陰影 */}
                            <div className="w-40 h-4 bg-black/20 rounded-[100%] blur-sm mt-4"></div>

                            {isShaking && (
                            <div className="absolute top-10 text-[#8B4513] font-bold animate-pulse font-serif text-xl tracking-widest">
                                搖啊搖...
                            </div>
                            )}
                        </div>

                        {/* 控制面板 */}
                        <div className="bg-[#FAEBD7] rounded-t-3xl border-t-2 border-[#DEB887] p-5 space-y-4 shadow-[0_-5px_20px_rgba(139,69,19,0.1)]">
                            
                            {/* 數量控制 */}
                            <div className="flex items-center justify-between bg-[#FFF8DC] p-3 rounded-xl border border-[#DEB887] shadow-inner">
                            <span className="text-[#8B4513] font-bold text-sm ml-2 font-serif">求籤支數</span>
                            <div className="flex items-center gap-3">
                                <button onClick={() => setDrawCount(Math.max(1, drawCount - 1))} className="w-8 h-8 rounded-lg bg-[#DEB887] hover:bg-[#D2B48C] text-[#8B4513] font-bold">-</button>
                                <span className="text-xl font-bold text-[#8B0000] w-6 text-center">{Math.min(drawCount, selectedNames.length || 1)}</span>
                                <button onClick={() => setDrawCount(Math.min(selectedNames.length, drawCount + 1))} className="w-8 h-8 rounded-lg bg-[#DEB887] hover:bg-[#D2B48C] text-[#8B4513] font-bold">+</button>
                            </div>
                            </div>

                            {/* 快速選人區 */}
                            <div className="space-y-2">
                            <div className="flex justify-between items-center px-1">
                                <span className="text-xs font-bold text-[#A0522D] uppercase tracking-wider">名冊 ({selectedNames.length}/{participants.length})</span>
                                <button onClick={toggleAll} className="text-xs text-[#8B4513] hover:text-[#8B0000] font-bold flex items-center gap-1 border-b border-[#8B4513] border-dashed">
                                {selectedNames.length === participants.length ? '全退' : '全選'}
                                </button>
                            </div>
                            <div className="flex flex-wrap gap-2 max-h-[120px] overflow-y-auto p-1 content-start custom-scrollbar">
                                {participants.length === 0 ? (
                                <div className="w-full text-center py-4 text-[#A0522D] text-sm bg-[#FFF8DC] rounded-xl border border-dashed border-[#DEB887]">籤筒是空的</div>
                                ) : (
                                participants.map(name => (
                                    <button key={name} onClick={() => toggleSelection(name)}
                                    className={`px-3 py-1.5 rounded-sm text-sm font-bold transition-all border flex items-center gap-1.5 font-serif ${
                                        selectedNames.includes(name) 
                                        ? 'bg-[#8B0000] text-[#FFD700] border-[#8B0000] shadow-md' 
                                        : 'bg-[#FFF8DC] text-[#DEB887] border-[#DEB887] grayscale opacity-70'
                                    }`}>
                                    {selectedNames.includes(name) ? <CheckSquare className="w-3 h-3" /> : <Square className="w-3 h-3" />}
                                    {name}
                                    </button>
                                ))
                                )}
                            </div>
                            </div>

                            {/* 搖籤按鈕 */}
                            <button 
                            onClick={handleDraw} 
                            disabled={isShaking || selectedNames.length === 0}
                            className={`w-full py-4 rounded-xl text-[#FFD700] text-xl font-black shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 border-2 border-[#B8860B] font-serif tracking-widest
                                ${isShaking || selectedNames.length === 0 
                                ? 'bg-[#A0522D] cursor-not-allowed grayscale' 
                                : 'bg-[#8B0000] hover:bg-[#A52A2A] hover:shadow-[#8B0000]/50'
                                }`}
                            >
                            {isShaking ? '搖籤中...' : '搖一搖'}
                            </button>
                        </div>
                        </div>
                    )}

                    {/* === View: Manage (名冊) === */}
                    {currentView === 'manage' && (
                        <div className="p-6 space-y-5 pb-20">
                        <div className="flex gap-2">
                            <input type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && addParticipant()} placeholder="輸入名字..."
                            className="flex-1 bg-[#FFF8DC] border-2 border-[#DEB887] rounded-xl px-4 py-3 focus:ring-2 focus:ring-[#8B4513] outline-none text-[#8B4513] placeholder-[#D2B48C] font-serif" />
                            <button onClick={addParticipant} className="bg-[#8B4513] text-[#FFD700] p-3 rounded-xl hover:bg-[#A0522D] shadow-md border border-[#8B4513]"><Plus className="w-6 h-6" /></button>
                        </div>

                        <div className="flex justify-between items-center mt-2 px-1">
                            <h3 className="font-bold text-[#8B4513] font-serif">善男信女 ({participants.length})</h3>
                            {participants.length > 0 && (
                            <button onClick={() => setDeleteModal({ show: true, type: 'all-participants' })} className="text-xs text-red-600 hover:text-red-800 flex items-center gap-1 bg-red-100 px-3 py-1.5 rounded-lg font-medium">
                                <Trash2 className="w-3 h-3" /> 倒空
                            </button>
                            )}
                        </div>

                        <div className="space-y-3">
                            {participants.map((name, index) => (
                            <div key={index} className="group bg-[#FAEBD7] border border-[#DEB887] p-2 pl-4 rounded-xl flex justify-between items-center shadow-sm">
                                {editingIndex === index ? (
                                <div className="flex-1 flex gap-2 mr-2">
                                    <input ref={editInputRef} type="text" value={editValue} onChange={(e) => setEditValue(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter') saveEdit(index); if(e.key === 'Escape') setEditingIndex(null); }}
                                    className="flex-1 bg-white text-[#8B4513] px-2 py-1 rounded outline-none border border-[#DEB887]" />
                                </div>
                                ) : (
                                <div className="flex items-center gap-3 flex-1 overflow-hidden">
                                    <div className="w-8 h-8 rounded-full bg-[#DEB887] text-[#8B4513] flex items-center justify-center text-xs font-bold shrink-0">{name[0]}</div>
                                    <span className="font-medium text-[#5c3a21] truncate font-serif">{name}</span>
                                </div>
                                )}
                                <div className="flex items-center gap-1 shrink-0">
                                {editingIndex === index ? (
                                    <>
                                    <button onClick={() => saveEdit(index)} className="p-2 text-green-700 hover:bg-green-100 rounded-lg"><Check className="w-5 h-5" /></button>
                                    <button onClick={() => setEditingIndex(null)} className="p-2 text-[#8B4513] hover:bg-[#DEB887]/50 rounded-lg"><X className="w-5 h-5" /></button>
                                    </>
                                ) : (
                                    <>
                                    <button onClick={() => startEdit(index)} className="p-2 text-[#8B4513] hover:text-[#8B0000] hover:bg-[#DEB887]/30 rounded-lg"><Edit2 className="w-4 h-4" /></button>
                                    <button onClick={() => setDeleteModal({ show: true, type: 'single', index, name })} className="p-2 text-[#8B4513] hover:text-red-600 hover:bg-red-50 rounded-lg"><Trash2 className="w-4 h-4" /></button>
                                    </>
                                )}
                                </div>
                            </div>
                            ))}
                        </div>
                        </div>
                    )}

                    {/* === View: History (籤詩錄) === */}
                    {currentView === 'history' && (
                        <div className="p-6 space-y-4">
                        <div className="flex justify-between items-center mb-2 px-1">
                            <h3 className="font-bold text-[#8B4513] font-serif">過往靈籤</h3>
                            {history.length > 0 && (
                            <button onClick={() => setDeleteModal({ show: true, type: 'all-history' })} className="text-xs text-red-600 hover:bg-red-50 px-2 py-1 rounded-lg flex items-center gap-1"><Trash2 className="w-3 h-3" /> 燒毀</button>
                            )}
                        </div>
                        <div className="space-y-3 pb-20">
                            {history.map((record) => (
                            <div key={record.id} className="bg-[#FAEBD7] border-l-4 border-[#8B0000] rounded-r-xl p-4 shadow-sm relative">
                                <div className="absolute top-2 right-2 opacity-10"><Scroll className="w-12 h-12" /></div>
                                <div className="flex justify-between items-center mb-2 border-b border-[#DEB887] pb-2">
                                <span className="text-xs font-bold text-[#8B4513] font-serif">{record.date.split(' ')[1]} · 吉時</span> 
                                </div>
                                <div className="flex flex-wrap gap-2">
                                {record.result.map((name, idx) => (
                                    <span key={idx} className="text-sm font-bold text-[#8B0000] bg-[#FFD700]/20 px-2 py-1 rounded border border-[#DEB887] flex items-center gap-1 font-serif">
                                    {name}
                                    </span>
                                ))}
                                </div>
                            </div>
                            ))}
                            {history.length === 0 && <div className="text-center py-16 text-[#D2B48C]"><History className="w-12 h-12 mx-auto mb-3 opacity-50" /><p>暫無紀錄</p></div>}
                        </div>
                        </div>
                    )}
                    </div>
                </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>


